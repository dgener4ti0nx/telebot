#!/bin/bash
TOKEN=$(<$HOME/telebot/token)
CHATID=$(<$HOME/telebot/chat_id)
STDIN=$(cat)

MESSAGE=$STDIN
################### Add bot
if [[ -z "$TOKEN" ]]; then
	echo "No bot TOKEN specified.\nPlease add bot by sending:\ntelebot -b [token]"
fi
if [[ $1 == "-b" ]] then
	echo "$2">>$HOME/telebot/token
fi
################### Add user
if [[ -z "$CHATID" ]]; then
	echo "No CHATID values found.\nPlease add users by sending:\ntelebot -a [user] [chatid]"
fi
if [[ $1 == "-a" ]] then
	echo "$2\t$3\n">>$HOME/telebot/chat_id
fi
################### Send
if [[ $1 == "-s" ]]; then
	if [ $2 == "$(grep $CHATID "$2" | cut -d "\t" -f1-)" ]
		then CHATID="$(grep $CHATID "$2"| cut -d "\t" -f2-)"
	else
		echo "Sorry, user was not found."
	exit 1
	fi
	curl -s -X POST https://api.telegram.org/bot$TOKEN/sendMessage -d chat_id=$CHATID -d text="$MESSAGE" -d parse_mode="markdown" > /dev/null
	echo -e "Sent to $2: $MESSAGE"
	exit 2
fi

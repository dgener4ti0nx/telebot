#!/bin/bash
TOKEN=$(<$HOME/telebot/token)
USER=$(<$HOME/telebot/users)
STDIN=$(cat)

MESSAGE=$STDIN
################### Add bot
if [[ -z "$TOKEN" ]]; then
	echo "No bot TOKEN specified.\nPlease add bot by sending:\ntelebot -b [token]"
	exit 1
fi
if [[ $1 == "-b" ]]; then
	echo "$2">>$HOME/telebot/token
	exit 2
fi
################### Add user
if [[ -z "$CHATID" ]]; then
	echo "No user values found.\nPlease add users by sending:\ntelebot -a [user] [chatid]"
	exit 1
fi
if [[ $1 == "-a" ]]; then
	echo "$2\t$3\n">>$HOME/telebot/users
	exit 2
fi
################### Send
if [[ $1 == "-s" ]]; then
	if [ $2 == "$(grep $USER "$2" | cut -d "\t" -f1-)" ]; then
			CHATID="$(grep $USER "$2"| cut -d "\t" -f2-)"
	else
		echo "Sorry, user was not found."
	exit 1
	fi
	curl -s -X POST https://api.telegram.org/bot$TOKEN/sendMessage -d chat_id=$CHATID -d text="$MESSAGE" -d parse_mode="markdown" > /dev/null
	echo -e "Sent to $2: $MESSAGE"
	exit 2
fi
